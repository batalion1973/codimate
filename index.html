
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ì½”ë””ë©”ì´íŠ¸ - AI íŒ¨ì…˜ ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *{-webkit-tap-highlight-color:transparent;box-sizing:border-box}body{font-family:'Noto Sans KR',sans-serif;background:linear-gradient(180deg,#0f0f0f 0%,#1a1a1a 100%);min-height:100vh;margin:0}.glass-card{background:rgba(255,255,255,.03);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08)}.btn-primary{background:linear-gradient(135deg,#f19a3e 0%,#ed7d1a 100%);box-shadow:0 4px 20px rgba(241,154,62,.3)}.btn-secondary{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.15)}.style-chip.selected{background:linear-gradient(135deg,#f19a3e 0%,#ed7d1a 100%);border-color:transparent;color:#fff}.progress-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.2);transition:all .3s}.progress-dot.active{background:#f19a3e;width:24px;border-radius:4px}.progress-dot.completed{background:#f19a3e}.loading-spinner{border:3px solid rgba(255,255,255,.1);border-top-color:#f19a3e;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in{animation:fadeIn .4s ease forwards}input{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:16px;color:#fff;font-size:18px;width:100%;text-align:center;outline:none}input:focus{border-color:#f19a3e;background:rgba(241,154,62,.1)}input::-webkit-inner-spin-button{-webkit-appearance:none}.custom-tag{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#f19a3e,#ed7d1a);padding:8px 12px;border-radius:20px;font-size:14px;color:#fff}.custom-tag button{background:rgba(255,255,255,.3);border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center}.outfit-item{background:linear-gradient(135deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);transition:all .3s}.outfit-item:hover{border-color:rgba(241,154,62,.3);transform:translateX(4px)}.placeholder-image{background:linear-gradient(135deg,#1a1a1a 0%,#0f0f0f 100%);display:flex;flex-direction:column;align-items:center;justify-content:center}.download-btn{position:absolute;top:12px;right:12px;background:rgba(0,0,0,.6);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}.download-btn:hover{background:rgba(241,154,62,.8)}.ai-thinking{background:linear-gradient(90deg,rgba(241,154,62,.1),rgba(241,154,62,.2),rgba(241,154,62,.1));background-size:200% 100%;animation:shimmer 1.5s infinite}@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useCallback,useRef}=React;
const GEMINI_API_KEY='AIzaSyAb8Wq-Eh7rzAk3ZsVpvJiL5ZXq_DTnuiU';
const GEMINI_TEXT_URL='https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

const weatherCodeMap={0:{condition:'ë§‘ìŒ',icon:'â˜€ï¸'},1:{condition:'ëŒ€ì²´ë¡œ ë§‘ìŒ',icon:'ğŸŒ¤ï¸'},2:{condition:'êµ¬ë¦„ ì¡°ê¸ˆ',icon:'â›…'},3:{condition:'íë¦¼',icon:'â˜ï¸'},45:{condition:'ì•ˆê°œ',icon:'ğŸŒ«ï¸'},48:{condition:'ì§™ì€ ì•ˆê°œ',icon:'ğŸŒ«ï¸'},51:{condition:'ê°€ë²¼ìš´ ì´ìŠ¬ë¹„',icon:'ğŸŒ¦ï¸'},53:{condition:'ì´ìŠ¬ë¹„',icon:'ğŸŒ¦ï¸'},55:{condition:'ì§™ì€ ì´ìŠ¬ë¹„',icon:'ğŸŒ§ï¸'},61:{condition:'ì•½í•œ ë¹„',icon:'ğŸŒ§ï¸'},63:{condition:'ë¹„',icon:'ğŸŒ§ï¸'},65:{condition:'ê°•í•œ ë¹„',icon:'ğŸŒ§ï¸'},71:{condition:'ì•½í•œ ëˆˆ',icon:'ğŸŒ¨ï¸'},73:{condition:'ëˆˆ',icon:'â„ï¸'},75:{condition:'ê°•í•œ ëˆˆ',icon:'â„ï¸'},77:{condition:'ì§„ëˆˆê¹¨ë¹„',icon:'ğŸŒ¨ï¸'},80:{condition:'ì†Œë‚˜ê¸°',icon:'ğŸŒ¦ï¸'},81:{condition:'ì†Œë‚˜ê¸°',icon:'ğŸŒ§ï¸'},82:{condition:'ê°•í•œ ì†Œë‚˜ê¸°',icon:'â›ˆï¸'},95:{condition:'ë‡Œìš°',icon:'â›ˆï¸'},96:{condition:'ìš°ë°• ë™ë°˜ ë‡Œìš°',icon:'â›ˆï¸'},99:{condition:'ê°•í•œ ìš°ë°• ë‡Œìš°',icon:'â›ˆï¸'}};

function calculateFeelsLike(temp,windSpeed,humidity){if(temp<=10){const v=windSpeed*3.6;if(v>=4.8)return Math.round(13.12+.6215*temp-11.37*Math.pow(v,.16)+.3965*Math.pow(v,.16)*temp)}if(temp>=25&&humidity>=40)return Math.round(temp+.33*humidity/100*6.105*Math.exp(17.27*temp/(237.7+temp))-4);return Math.round(temp)}

function generateTrendData(){const now=new Date();const year=now.getFullYear();const month=now.getMonth()+1;const prevYear=year-1;let season,seasonKr,seasonYear;if(month>=3&&month<=5){season='spring';seasonKr='ë´„';seasonYear=year+' S/S'}else if(month>=6&&month<=8){season='summer';seasonKr='ì—¬ë¦„';seasonYear=year+' S/S'}else if(month>=9&&month<=11){season='fall';seasonKr='ê°€ì„';seasonYear=year+' F/W'}else{season='winter';seasonKr='ê²¨ìš¸';seasonYear=month===12?year+'/'+(year+1)+' F/W':prevYear+'/'+year+' F/W'}
const trends={winter:{keywords:['ëª¨ì¹´ë¬´ìŠ¤','ë“œë®¤ì–´ë£©','ê³ í”„ì½”ì–´','ì˜¬ë“œë¨¸ë‹ˆ'],colors:['ë²„ê±´ë””','ì˜¬ë¦¬ë¸Œê·¸ë¦°','í¬ë¦¼','ë² ì´ì§€','ì¹´ë©œ','ë„¤ì´ë¹„','ì°¨ì½œ'],items:['ë¡±íŒ¨ë”©','ìˆíŒ¨ë”©','ì‹œì–´ë§ì¬í‚·','í„°í‹€ë„¥','ê¸°ëª¨ë°”ì§€','ìš¸ì½”íŠ¸','ìºì‹œë¯¸ì–´ë‹ˆíŠ¸'],styles:['ë ˆì´ì–´ë“œ','í´ë˜ì‹í…Œì¼ëŸ¬ë§','ë¯¸ë‹ˆë©€'],accessories:['ë‹ˆíŠ¸ë¹„ë‹ˆ','ë¨¸í”ŒëŸ¬','ë°©í•œë¶€ì¸ ','ë ˆë”ì¥ê°‘']},fall:{keywords:['ë“œë®¤ì–´ë£©','ë ˆì´ì–´ë“œ'],colors:['ë²„ê±´ë””','ì¹´ë©œ','ë¸Œë¼ìš´','ë² ì´ì§€'],items:['íŠ¸ë Œì¹˜ì½”íŠ¸','ë‹ˆíŠ¸','ìŠ¬ë™ìŠ¤','ê°€ë””ê±´'],styles:['ë ˆì´ì–´ë§','í´ë˜ì‹'],accessories:['ìŠ¤ì¹´í”„','ë¡œí¼']},spring:{keywords:['íŒŒìŠ¤í…”','ë ˆì´ì–´ë“œ'],colors:['íŒŒìŠ¤í…”í•‘í¬','ë¯¼íŠ¸','í¬ë¦¼','ë¼ë²¤ë”'],items:['íŠ¸ë Œì¹˜','ë°ë‹˜ì¬í‚·','ìŠ¬ë™ìŠ¤','ë¸”ë¼ìš°ìŠ¤'],styles:['ìºì£¼ì–¼','í´ë¦°ë£©'],accessories:['ìº”ë²„ìŠ¤ë°±','ë¡œí¼']},summer:{keywords:['ë¦°ë„¨','ë¯¸ë‹ˆë©€'],colors:['í™”ì´íŠ¸','ìŠ¤ì¹´ì´ë¸”ë£¨','ë² ì´ì§€'],items:['ë¦°ë„¨ì…”ì¸ ','ë°˜ë°”ì§€','ìƒŒë“¤','ë©´í‹°'],styles:['ë¯¸ë‹ˆë©€','ë¦¬ì¡°íŠ¸'],accessories:['ì„ ê¸€ë¼ìŠ¤','ë²„í‚·í–‡']}};return{seasonYear,season,seasonKr,...trends[season]}}

// ì—°ë ¹ëŒ€ë³„ ìŠ¤íƒ€ì¼ íŠ¹ì„±
const ageStyleMap={
  teen:{desc:'10ëŒ€ ì²­ì†Œë…„',look:'í•™ìƒ ëŠë‚Œì˜ ìºì£¼ì–¼í•˜ê³  íŠ¸ë Œë””í•œ',items:['í›„ë“œí‹°','ì¡°ê±°íŒ¬ì¸ ','ìŠ¤ë‹ˆì»¤ì¦ˆ','ë°±íŒ©'],colors:['ë°ì€ìƒ‰','íŒŒìŠ¤í…”','ë„¤ì˜¨'],avoid:['ì •ì¥','í¬ë©€']},
  twenty:{desc:'20ëŒ€ ì²­ë…„',look:'ì Šê³  ì„¸ë ¨ëœ íŠ¸ë Œë””í•œ',items:['ì˜¤ë²„ì‚¬ì´ì¦ˆ ì…”ì¸ ','ì™€ì´ë“œíŒ¬ì¸ ','ì²­í‚¤ìŠ¤ë‹ˆì»¤ì¦ˆ'],colors:['ëª¨ë˜í•œ ì»¬ëŸ¬','ë‰´íŠ¸ëŸ´'],avoid:['ì˜¬ë“œí•œ ìŠ¤íƒ€ì¼']},
  thirty:{desc:'30ëŒ€ ì„±ì¸',look:'ì„¸ë ¨ë˜ê³  ê¹”ë”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ìºì£¼ì–¼',items:['ë‹ˆíŠ¸','ìŠ¬ë™ìŠ¤','ë¡œí¼','ë¯¸ë‹ˆë©€ë°±'],colors:['ì°¨ë¶„í•œ í†¤','ë² ì´ì§€','ë„¤ì´ë¹„'],avoid:['ë„ˆë¬´ ìºì£¼ì–¼']},
  forty:{desc:'40ëŒ€ ì¤‘ë…„',look:'í’ˆê²©ìˆê³  í´ë˜ì‹í•œ',items:['ìºì‹œë¯¸ì–´ë‹ˆíŠ¸','ìš¸ì½”íŠ¸','ê°€ì£½ì‹ ë°œ'],colors:['í´ë˜ì‹ ì»¬ëŸ¬','ë„¤ì´ë¹„','ì°¨ì½œ','ì¹´ë©œ'],avoid:['íŠ¸ë Œë””í•œ ë¡œê³ ']},
  fifty:{desc:'50ëŒ€ ì´ìƒ',look:'ê³ ê¸‰ìŠ¤ëŸ½ê³  í¸ì•ˆí•œ í´ë˜ì‹',items:['ìºì‹œë¯¸ì–´','ìš¸ì†Œì¬','í¸í•œ êµ¬ë‘'],colors:['ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë¬´ì±„ìƒ‰','ë² ì´ì§€','ë¸Œë¼ìš´'],avoid:['ì Šì€ ìŠ¤íƒ€ì¼']}
};

function getAgeStyle(age){
  if(age<20)return ageStyleMap.teen;
  if(age<30)return ageStyleMap.twenty;
  if(age<40)return ageStyleMap.thirty;
  if(age<50)return ageStyleMap.forty;
  return ageStyleMap.fifty;
}

const styleCategories=[{category:'ë² ì´ì§',options:[{id:'minimal',label:'ë¯¸ë‹ˆë©€',emoji:'â—»ï¸'},{id:'casual',label:'ìºì£¼ì–¼',emoji:'ğŸ‘•'},{id:'basic',label:'ë² ì´ì§',emoji:'âšª'},{id:'clean',label:'í´ë¦°í•',emoji:'âœ¨'}]},{category:'íŠ¸ë Œë””',options:[{id:'street',label:'ìŠ¤íŠ¸ë¦¿',emoji:'ğŸ§¢'},{id:'hiphop',label:'í™í•©',emoji:'ğŸ¤'},{id:'y2k',label:'Y2K',emoji:'ğŸ’¿'},{id:'techwear',label:'í…Œí¬ì›¨ì–´',emoji:'ğŸ¦¾'},{id:'gorpcore',label:'ê³ í”„ì½”ì–´',emoji:'ğŸ”ï¸'}]},{category:'í´ë˜ì‹',options:[{id:'formal',label:'í¬ë©€',emoji:'ğŸ‘”'},{id:'business',label:'ë¹„ì¦ˆìºì£¼ì–¼',emoji:'ğŸ’¼'},{id:'preppy',label:'í”„ë ˆí”¼',emoji:'ğŸ“'},{id:'oldmoney',label:'ì˜¬ë“œë¨¸ë‹ˆ',emoji:'ğŸ’°'},{id:'classic',label:'í´ë˜ì‹',emoji:'ğŸ©'}]},{category:'ì•¡í‹°ë¸Œ',options:[{id:'sporty',label:'ìŠ¤í¬í‹°',emoji:'ğŸƒ'},{id:'athleisure',label:'ì• ìŠ¬ë ˆì €',emoji:'ğŸ§˜'},{id:'outdoor',label:'ì•„ì›ƒë„ì–´',emoji:'â›º'},{id:'workwear',label:'ì›Œí¬ì›¨ì–´',emoji:'ğŸ”§'}]},{category:'ê°ì„±',options:[{id:'romantic',label:'ë¡œë§¨í‹±',emoji:'ğŸŒ¸'},{id:'vintage',label:'ë¹ˆí‹°ì§€',emoji:'ğŸ“»'},{id:'bohemian',label:'ë³´í—¤ë¯¸ì•ˆ',emoji:'ğŸª¶'},{id:'grunge',label:'ê·¸ëŸ°ì§€',emoji:'ğŸ¸'},{id:'dark',label:'ë‹¤í¬ì›¨ì–´',emoji:'ğŸ–¤'}]},{category:'í•˜ì´ì—”ë“œ',options:[{id:'luxury',label:'ëŸ­ì…”ë¦¬',emoji:'ğŸ’'},{id:'avantgarde',label:'ì•„ë°©ê°€ë¥´ë“œ',emoji:'ğŸ­'},{id:'minimalchic',label:'ë¯¸ë‹ˆë©€ì‹œí¬',emoji:'ğŸ”²'}]}];

const Icons={Home:()=><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,Closet:()=><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="12" y1="3" x2="12" y2="21"/></svg>,Trend:()=><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,Profile:()=><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,Refresh:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,Cart:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>,Chevron:()=><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,Location:()=><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,Download:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,Reset:()=><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,Sparkle:()=><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"/></svg>};

async function fetchWeather(lat,lon){try{const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,relative_humidity_2m,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min&timezone=auto`;const res=await fetch(url);const data=await res.json();const code=data.current.weather_code;const weatherInfo=weatherCodeMap[code]||{condition:'ì•Œ ìˆ˜ ì—†ìŒ',icon:'ğŸŒ¡ï¸'};const temp=data.current.temperature_2m;const wind=data.current.wind_speed_10m;const humidity=data.current.relative_humidity_2m;const feelsLike=calculateFeelsLike(temp,wind,humidity);return{temperature:Math.round(temp),tempMax:Math.round(data.daily.temperature_2m_max[0]),tempMin:Math.round(data.daily.temperature_2m_min[0]),feelsLike,condition:weatherInfo.condition,icon:weatherInfo.icon,humidity,wind}}catch(e){console.error('Weather error:',e);return null}}

async function fetchLocationName(lat,lon){try{const url=`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&accept-language=ko`;const res=await fetch(url);const data=await res.json();return data.address?.city||data.address?.town||data.address?.county||data.address?.state||'í˜„ì¬ ìœ„ì¹˜'}catch(e){return'í˜„ì¬ ìœ„ì¹˜'}}

function downloadImage(dataUrl,filename){const link=document.createElement('a');link.href=dataUrl;link.download=filename;document.body.appendChild(link);link.click();document.body.removeChild(link)}

function Onboarding({onComplete}){const[step,setStep]=useState(0);const[profile,setProfile]=useState({gender:'',birthYear:'',styles:[],customStyles:[]});const[customInput,setCustomInput]=useState('');const year=new Date().getFullYear();const validYear=profile.birthYear&&+profile.birthYear>=1940&&+profile.birthYear<=year-10;const toggleStyle=id=>setProfile(p=>({...p,styles:p.styles.includes(id)?p.styles.filter(s=>s!==id):[...p.styles,id]}));const addCustom=()=>{if(customInput.trim()&&!profile.customStyles.includes(customInput.trim())){setProfile(p=>({...p,customStyles:[...p.customStyles,customInput.trim()]}));setCustomInput('')}};const removeCustom=s=>setProfile(p=>({...p,customStyles:p.customStyles.filter(x=>x!==s)}));const canNext=()=>step===0||(step===1&&profile.gender)||(step===2&&validYear)||(step===3&&(profile.styles.length||profile.customStyles.length));
return(<div className="min-h-screen flex flex-col px-6 py-8"><div className="flex justify-center gap-2 mb-8">{[0,1,2,3].map(i=><div key={i} className={`progress-dot ${i===step?'active':i<step?'completed':''}`}/>)}</div><div className="flex-1 flex flex-col justify-center overflow-y-auto">{step===0&&<div className="text-center animate-fade-in"><div className="text-6xl mb-6">ğŸ‘”</div><h1 className="text-3xl font-bold text-white mb-4" style={{fontFamily:'Outfit'}}>ì½”ë””ë©”ì´íŠ¸</h1><p className="text-gray-400 text-lg">AIê°€ ë‚ ì”¨, íŠ¸ë Œë“œ, ë‹¹ì‹ ì˜ ì·¨í–¥ì„<br/>ì¢…í•© ë¶„ì„í•˜ì—¬ ì½”ë””ë¥¼ ì¶”ì²œí•´ìš”</p></div>}{step===1&&<div className="animate-fade-in"><h2 className="text-2xl font-bold text-white text-center mb-2">ìŠ¤íƒ€ì¼ ì„±í–¥ ì„ íƒ</h2><p className="text-gray-400 text-center mb-8">ë§ì¶¤ ì¶”ì²œì„ ìœ„í•´ í•„ìš”í•´ìš”</p><div className="flex flex-col gap-3 max-w-sm mx-auto">{[{id:'male',label:'ë‚¨ì„± ìŠ¤íƒ€ì¼',emoji:'ğŸ‘¨',desc:'ë‚¨ì„±ì ì¸ í•'},{id:'female',label:'ì—¬ì„± ìŠ¤íƒ€ì¼',emoji:'ğŸ‘©',desc:'ì—¬ì„±ì ì¸ í•'},{id:'unisex',label:'ìœ ë‹ˆì„¹ìŠ¤',emoji:'ğŸ§‘',desc:'ì  ë”ë¦¬ìŠ¤ ì˜¤ë²„í•'}].map(o=><button key={o.id} onClick={()=>setProfile(p=>({...p,gender:o.id}))} className={`w-full py-4 px-5 rounded-2xl border-2 flex items-center gap-4 transition-all ${profile.gender===o.id?'border-orange-400 bg-orange-400/10':'border-white/10 bg-white/5'}`}><span className="text-3xl">{o.emoji}</span><div className="text-left"><div className="text-white font-medium">{o.label}</div><div className="text-gray-500 text-sm">{o.desc}</div></div></button>)}</div></div>}{step===2&&<div className="animate-fade-in"><h2 className="text-2xl font-bold text-white text-center mb-2">ì¶œìƒì—°ë„ ì…ë ¥</h2><p className="text-gray-400 text-center mb-8">ì—°ë ¹ëŒ€ì— ë§ëŠ” ìŠ¤íƒ€ì¼ ì¶”ì²œ</p><div className="max-w-xs mx-auto"><input type="number" placeholder="ì˜ˆ: 1995" value={profile.birthYear} onChange={e=>setProfile(p=>({...p,birthYear:e.target.value}))}/>{profile.birthYear&&<p className={`text-center mt-4 ${validYear?'text-orange-400':'text-red-400 text-sm'}`}>{validYear?`${year-+profile.birthYear}ì„¸`:'ì˜¬ë°”ë¥¸ ì—°ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš”'}</p>}</div></div>}{step===3&&<div className="animate-fade-in max-h-[55vh] overflow-y-auto"><h2 className="text-2xl font-bold text-white text-center mb-2">ì„ í˜¸ ìŠ¤íƒ€ì¼</h2><p className="text-gray-400 text-center mb-6">ì—¬ëŸ¬ ê°œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥</p>{styleCategories.map((cat,i)=><div key={i} className="mb-5"><h3 className="text-gray-500 text-sm mb-2">{cat.category}</h3><div className="flex flex-wrap gap-2">{cat.options.map(s=><button key={s.id} onClick={()=>toggleStyle(s.id)} className={`style-chip px-3 py-2 rounded-full border-2 flex items-center gap-1.5 text-sm transition-all ${profile.styles.includes(s.id)?'selected':'border-white/10 bg-white/5 text-gray-300'}`}><span>{s.emoji}</span>{s.label}</button>)}</div></div>)}<div className="mt-4 mb-4"><h3 className="text-gray-500 text-sm mb-2">ì§ì ‘ ì…ë ¥</h3><div className="flex gap-2"><input type="text" placeholder="ì›í•˜ëŠ” ìŠ¤íƒ€ì¼" value={customInput} onChange={e=>setCustomInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&addCustom()} className="flex-1 text-left text-base px-4"/><button onClick={addCustom} disabled={!customInput.trim()} className="px-4 py-2 bg-orange-500 text-white rounded-xl disabled:opacity-50">ì¶”ê°€</button></div>{profile.customStyles.length>0&&<div className="flex flex-wrap gap-2 mt-3">{profile.customStyles.map((s,i)=><span key={i} className="custom-tag">{s}<button onClick={()=>removeCustom(s)}>Ã—</button></span>)}</div>}</div></div>}</div><button onClick={()=>step<3?setStep(step+1):onComplete(profile)} disabled={!canNext()} className={`w-full py-4 rounded-2xl font-semibold text-white mt-6 transition-all ${canNext()?'btn-primary':'bg-gray-700 opacity-50'}`}>{step===3?'ì‹œì‘í•˜ê¸°':'ë‹¤ìŒ'}</button></div>)}

function WeatherCard({weather,location,loading}){if(loading)return<div className="glass-card rounded-2xl p-5 mb-4"><div className="flex items-center justify-center py-8"><div className="loading-spinner mr-3" style={{width:24,height:24,borderWidth:2}}/><span className="text-gray-400">ë‚ ì”¨ ì •ë³´ ë¶„ì„ ì¤‘...</span></div></div>;if(!weather)return null;return<div className="glass-card rounded-2xl p-5 mb-4 relative overflow-hidden"><div className="absolute inset-0" style={{background:'radial-gradient(ellipse at top right, rgba(241,154,62,0.1) 0%, transparent 60%)'}}/><div className="relative z-10"><div className="flex justify-between items-start mb-3"><div className="flex items-center gap-2"><span className="text-orange-400"><Icons.Location/></span><span className="text-white font-medium">{location}</span></div><span className="text-xs text-green-400 bg-green-400/10 px-2 py-0.5 rounded-full">ì‹¤ì‹œê°„</span></div><div className="flex justify-between items-center"><div><div className="flex items-baseline gap-1"><span className="text-5xl font-bold text-white" style={{fontFamily:'Outfit'}}>{weather.temperature}</span><span className="text-2xl text-gray-400">Â°C</span></div><div className="text-orange-400 text-sm font-medium mt-1">ì²´ê° {weather.feelsLike}Â°C</div><div className="text-gray-500 text-xs mt-1">{weather.tempMin}Â°/{weather.tempMax}Â°</div></div><div className="text-right"><div className="text-5xl">{weather.icon}</div><div className="text-gray-300 text-sm">{weather.condition}</div></div></div></div></div>}

function AIThinkingIndicator({status}){return<div className="glass-card rounded-2xl p-6 mb-6"><div className="flex items-center gap-3 mb-4"><div className="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center" style={{animation:'pulse 2s ease-in-out infinite'}}><Icons.Sparkle/></div><div><p className="text-white font-medium">AI ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ ë¶„ì„ ì¤‘</p><p className="text-orange-400 text-sm">{status}</p></div></div><div className="space-y-2">{['ë‚ ì”¨ ë¶„ì„','ì—°ë ¹ëŒ€ ìŠ¤íƒ€ì¼','íŠ¸ë Œë“œ ë°˜ì˜'].map((step,i)=><div key={i} className="ai-thinking h-2 rounded-full" style={{animationDelay:`${i*.2}s`}}/>)}</div></div>}

function OutfitItem({item,i}){const emoji={'ìƒì˜':'ğŸ‘•','í•˜ì˜':'ğŸ‘–','ì•„ìš°í„°':'ğŸ§¥','ì´ë„ˆ':'ğŸ½','ì‹ ë°œ':'ğŸ‘Ÿ','ì†Œí’ˆ':'ğŸ‘œ','ëª¨ì':'ğŸ§¢','ê°€ë°©':'ğŸ‘œ'};return<div className="outfit-item rounded-xl p-4 animate-fade-in" style={{animationDelay:`${i*.08}s`}}><div className="flex items-center gap-4"><div className="w-12 h-12 rounded-lg bg-white/5 flex items-center justify-center text-2xl">{emoji[item.category]||'ğŸ‘”'}</div><div className="flex-1 min-w-0"><div className="text-xs text-orange-400 font-medium mb-1">{item.category}</div><div className="text-white font-medium truncate">{item.name}</div>{item.detail&&<div className="text-gray-500 text-sm truncate">{item.detail}</div>}</div><Icons.Chevron/></div></div>}

function PlaceholderImage({outfit,userInfo}){return<div className="aspect-[3/4] placeholder-image rounded-t-2xl p-6"><div className="text-center mb-6"><div className="text-6xl mb-3">ğŸ‘”</div><p className="text-gray-300 font-medium">ì˜¤ëŠ˜ì˜ AI ì¶”ì²œ ì½”ë””</p><p className="text-gray-500 text-sm mt-1">{userInfo}</p></div><div className="space-y-2">{outfit?.slice(0,5).map((item,i)=><div key={i} className="flex items-center gap-3 bg-white/5 rounded-lg p-2"><span className="text-xl">{{'ìƒì˜':'ğŸ‘•','í•˜ì˜':'ğŸ‘–','ì•„ìš°í„°':'ğŸ§¥','ì‹ ë°œ':'ğŸ‘Ÿ','ì†Œí’ˆ':'ğŸ‘œ'}[item.category]||'ğŸ‘”'}</span><div className="flex-1 min-w-0"><p className="text-white text-sm truncate">{item.name}</p><p className="text-gray-500 text-xs truncate">{item.detail}</p></div></div>)}</div></div>}

function HomeScreen({profile,weather,location,weatherLoading,onReset,refreshKey}){
const[outfit,setOutfit]=useState(null);
const[loading,setLoading]=useState(true);
const[aiStatus,setAiStatus]=useState('');
const[imgLoading,setImgLoading]=useState(false);
const[reason,setReason]=useState('');
const[image,setImage]=useState(null);
const[trendData,setTrendData]=useState(null);
const generationRef=useRef(0);

const styleMap={};styleCategories.forEach(c=>c.options.forEach(o=>styleMap[o.id]=o.label));
const getStyles=()=>[...profile.styles.map(s=>styleMap[s]||s),...profile.customStyles].join(', ')||'ìºì£¼ì–¼';
const getGender=()=>profile.gender==='male'?'ë‚¨ì„±':profile.gender==='female'?'ì—¬ì„±':'ìœ ë‹ˆì„¹ìŠ¤';
const getGenderEng=()=>profile.gender==='male'?'man':'woman';
const getAge=()=>new Date().getFullYear()-+profile.birthYear;
const getAgeGroup=()=>{const a=getAge();return a<20?'10ëŒ€':a<30?'20ëŒ€':a<40?'30ëŒ€':a<50?'40ëŒ€':'50ëŒ€ ì´ìƒ'};
const getUserInfo=()=>`${getAgeGroup()} ${getGender()} Â· ${getStyles()}`;

// ë‚˜ì´ì— ë”°ë¥¸ ì‹ ì²´ íŠ¹ì§• ì„¤ëª…
const getAgeDescription=()=>{
  const age=getAge();
  const gender=getGenderEng();
  if(age<20)return `teenage Korean ${gender}, young face, student appearance, around 16-19 years old`;
  if(age<30)return `young adult Korean ${gender} in their twenties, youthful and trendy, around 23-28 years old`;
  if(age<40)return `adult Korean ${gender} in their thirties, mature and professional, around 32-38 years old`;
  if(age<50)return `middle-aged Korean ${gender} in their forties, dignified appearance, around 42-48 years old`;
  return `mature Korean ${gender} in their fifties or older, distinguished and elegant, around 52-58 years old`;
};

const genImage=async(items,currentGen)=>{
  if(generationRef.current!==currentGen)return;
  setImgLoading(true);setImage(null);
  
  const age=getAge();
  const ageStyle=getAgeStyle(age);
  const userStyles=getStyles();
  
  // ê° ì•„ì´í…œì„ ìƒì„¸í•˜ê²Œ ì„¤ëª…
  const outfitDetails=items.map(i=>{
    const color=i.detail.split(',')[0]||'';
    return `${i.category}: ${i.name} in ${color} color`;
  }).join(', ');
  
  // ë‚˜ì´ì™€ ìŠ¤íƒ€ì¼ì— ë§ëŠ” ìƒì„¸í•œ í”„ë¡¬í”„íŠ¸
  const prompt=`Create a fashion photograph.

PERSON: ${getAgeDescription()}

EXACT OUTFIT TO WEAR:
${items.map(i=>`- ${i.name}: ${i.detail}`).join('\n')}

STYLE: ${ageStyle.look} ${userStyles} fashion style
SETTING: Modern Korean city street, daytime, natural lighting
POSE: Full body standing pose, looking at camera
QUALITY: High fashion magazine editorial photo

IMPORTANT: 
- The person MUST look ${age} years old (${ageStyle.desc})
- Clothing must EXACTLY match the items listed above
- No text, watermarks, or logos`;

  console.log('Image prompt:', prompt);
  
  try{
    const res=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        contents:[{parts:[{text:prompt}]}],
        generationConfig:{responseModalities:['Text','Image']}
      })
    });
    const data=await res.json();
    console.log('Image API response:', data);
    const parts=data.candidates?.[0]?.content?.parts||[];
    for(const p of parts){
      if(p.inlineData){
        setImage(`data:${p.inlineData.mimeType||'image/png'};base64,${p.inlineData.data}`);
        break;
      }
    }
  }catch(e){console.error('Image error:',e)}
  setImgLoading(false);
};

const generate=useCallback(async()=>{
  const currentGen=++generationRef.current;
  setLoading(true);setOutfit(null);setImage(null);setReason('');
  
  const trends=generateTrendData();
  setTrendData(trends);
  
  const feelsLike=weather?.feelsLike||0;
  const temp=weather?.temperature||0;
  const userAge=getAge();
  const userStyles=getStyles();
  const ageStyle=getAgeStyle(userAge);
  
  // ëœë¤ ìš”ì†Œ
  const randIdx=Math.floor(Math.random()*trends.colors.length);
  const mainColor=trends.colors[randIdx];
  const subColor=trends.colors[(randIdx+1)%trends.colors.length];
  const randItem=trends.items[Math.floor(Math.random()*trends.items.length)];
  
  setAiStatus(`${ageStyle.desc} ìŠ¤íƒ€ì¼ ë¶„ì„ ì¤‘...`);
  
  // ì—°ë ¹ëŒ€ë³„ ë§ì¶¤ í”„ë¡¬í”„íŠ¸
  const prompt=`ë‹¹ì‹ ì€ í•œêµ­ íŒ¨ì…˜ ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.

ëŒ€ìƒ: ${userAge}ì„¸ ${getGender()} (${ageStyle.desc})
ë‚ ì”¨: í˜„ì¬ ${temp}Â°C, ì²´ê° ${feelsLike}Â°C
ì„ í˜¸ ìŠ¤íƒ€ì¼: ${userStyles}
ì‹œì¦Œ íŠ¸ë Œë“œ: ${trends.keywords.join(', ')}
ì¶”ì²œ ì»¬ëŸ¬: ${mainColor}, ${subColor}

ì—°ë ¹ëŒ€ íŠ¹ì„±:
- ${ageStyle.desc}ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” ${ageStyle.look} ìŠ¤íƒ€ì¼
- ì¶”ì²œ ì•„ì´í…œ: ${ageStyle.items.join(', ')}
- ì–´ìš¸ë¦¬ëŠ” ì»¬ëŸ¬: ${ageStyle.colors.join(', ')}
- í”¼í•´ì•¼ í•  ê²ƒ: ${ageStyle.avoid.join(', ')}

ë‚ ì”¨ ê·œì¹™:
${feelsLike<0?'- ì²´ê°ì˜¨ë„ ì˜í•˜! ë°˜ë“œì‹œ ë‘êº¼ìš´ íŒ¨ë”©ì´ë‚˜ ë¡±ì½”íŠ¸ í•„ìˆ˜':feelsLike<10?'- ìŒ€ìŒ€í•œ ë‚ ì”¨, ì½”íŠ¸ë‚˜ ìì¼“ í•„ìš”':'- ë”°ëœ»í•œ ë‚ ì”¨, ê°€ë²¼ìš´ ì˜·ì°¨ë¦¼'}

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ${userAge}ì„¸ì—ê²Œ ë”± ë§ëŠ” ì½”ë””ë¥¼ ì¶”ì²œí•˜ì„¸ìš”.
ë°˜ë“œì‹œ ${mainColor}ê³¼ ${subColor} ì»¬ëŸ¬ë¥¼ í™œìš©í•˜ê³ , ${randItem}ì„ í¬í•¨í•˜ì„¸ìš”.

JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µ:
{"items":[{"category":"ì•„ìš°í„°","name":"êµ¬ì²´ì  ì•„ì´í…œëª…","detail":"${mainColor}, ì†Œì¬, í•"},{"category":"ìƒì˜","name":"","detail":""},{"category":"í•˜ì˜","name":"","detail":""},{"category":"ì‹ ë°œ","name":"","detail":""},{"category":"ì†Œí’ˆ","name":"","detail":""}],"reason":"${userAge}ì„¸ ${getGender()}ì„ ìœ„í•œ ì¶”ì²œ ì´ìœ  2-3ë¬¸ì¥"}`;

  console.log('Text prompt:', prompt);

  try{
    const res=await fetch(`${GEMINI_TEXT_URL}?key=${GEMINI_API_KEY}`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        contents:[{parts:[{text:prompt}]}],
        generationConfig:{temperature:1.2,maxOutputTokens:1500}
      })
    });

    const data=await res.json();
    console.log('Text API response:', data);
    
    const text=data.candidates?.[0]?.content?.parts?.[0]?.text||'';
    const jsonMatch=text.match(/\{[\s\S]*\}/);
    
    if(jsonMatch){
      const result=JSON.parse(jsonMatch[0]);
      console.log('Parsed outfit:', result);
      
      if(result.items&&result.items.length>0){
        if(generationRef.current!==currentGen)return;
        setOutfit(result.items);
        setReason(result.reason||`${userAge}ì„¸ ${getGender()}ì„ ìœ„í•œ ${trends.seasonKr} ì½”ë””ì…ë‹ˆë‹¤.`);
        setLoading(false);
        genImage(result.items,currentGen);
        return;
      }
    }
  }catch(e){
    console.error('Generation error:',e);
  }

  // í´ë°± - ì—°ë ¹ëŒ€ë³„ ì°¨ë³„í™”
  if(generationRef.current!==currentGen)return;
  
  let fallback;
  if(feelsLike<0){
    // í•œíŒŒ
    if(userAge<20){
      fallback=[
        {category:'ì•„ìš°í„°',name:'ë¡± íŒ¨ë”©',detail:`${mainColor}, ì˜¤ë²„í•, í•™ìƒ ìŠ¤íƒ€ì¼`},
        {category:'ìƒì˜',name:'í›„ë“œí‹°',detail:`${subColor}, ê¸°ëª¨, ìºì£¼ì–¼`},
        {category:'í•˜ì˜',name:'ì¡°ê±°íŒ¬ì¸ ',detail:'ë¸”ë™, ê¸°ëª¨ì•ˆê°'},
        {category:'ì‹ ë°œ',name:'í•˜ì´íƒ‘ ìŠ¤ë‹ˆì»¤ì¦ˆ',detail:'í™”ì´íŠ¸'},
        {category:'ì†Œí’ˆ',name:'ë¹„ë‹ˆ',detail:mainColor}
      ];
    }else if(userAge<30){
      fallback=[
        {category:'ì•„ìš°í„°',name:'ìˆ íŒ¨ë”©',detail:`${mainColor}, ìŠ¬ë¦¼í•`},
        {category:'ìƒì˜',name:'ë‹ˆíŠ¸',detail:`${subColor}, í„°í‹€ë„¥`},
        {category:'í•˜ì˜',name:'ì™€ì´ë“œ ìŠ¬ë™ìŠ¤',detail:'ì°¨ì½œ'},
        {category:'ì‹ ë°œ',name:'ì²¼ì‹œë¶€ì¸ ',detail:'ë¸”ë™ë ˆë”'},
        {category:'ì†Œí’ˆ',name:'ë¨¸í”ŒëŸ¬',detail:subColor}
      ];
    }else if(userAge<40){
      fallback=[
        {category:'ì•„ìš°í„°',name:'ìš¸ ë¡±ì½”íŠ¸',detail:`${mainColor}, í´ë˜ì‹í•`},
        {category:'ìƒì˜',name:'ìºì‹œë¯¸ì–´ ë‹ˆíŠ¸',detail:`${subColor}`},
        {category:'í•˜ì˜',name:'ìŠ¬ë™ìŠ¤',detail:'ë„¤ì´ë¹„, ìš¸í˜¼ë°©'},
        {category:'ì‹ ë°œ',name:'ë ˆë” ë¡œí¼',detail:'ë¸Œë¼ìš´'},
        {category:'ì†Œí’ˆ',name:'ìºì‹œë¯¸ì–´ ë¨¸í”ŒëŸ¬',detail:mainColor}
      ];
    }else{
      fallback=[
        {category:'ì•„ìš°í„°',name:'ìºì‹œë¯¸ì–´ ì½”íŠ¸',detail:`${mainColor}, í”„ë¦¬ë¯¸ì—„`},
        {category:'ìƒì˜',name:'í„°í‹€ë„¥ ë‹ˆíŠ¸',detail:`${subColor}, ê³ ê¸‰ì†Œì¬`},
        {category:'í•˜ì˜',name:'ìš¸ íŒ¬ì¸ ',detail:'ì°¨ì½œ, í¸ì•ˆí•œ í•'},
        {category:'ì‹ ë°œ',name:'ê°€ì£½ êµ¬ë‘',detail:'ë¸Œë¼ìš´, í´ë˜ì‹'},
        {category:'ì†Œí’ˆ',name:'ê°€ì£½ ì¥ê°‘',detail:mainColor}
      ];
    }
  }else if(feelsLike<15){
    // ì„ ì„ í•œ ë‚ ì”¨
    if(userAge<20){
      fallback=[
        {category:'ì•„ìš°í„°',name:'í•­ê³µì í¼',detail:`${mainColor}, ì˜¤ë²„í•`},
        {category:'ìƒì˜',name:'ë§¨íˆ¬ë§¨',detail:`${subColor}, ê·¸ë˜í”½`},
        {category:'í•˜ì˜',name:'ì™€ì´ë“œ ë°ë‹˜',detail:'ë¸”ë£¨'},
        {category:'ì‹ ë°œ',name:'ìŠ¤ë‹ˆì»¤ì¦ˆ',detail:'í™”ì´íŠ¸'},
        {category:'ì†Œí’ˆ',name:'ë³¼ìº¡',detail:'ë¸”ë™'}
      ];
    }else if(userAge<30){
      fallback=[
        {category:'ì•„ìš°í„°',name:'ë¸”ë ˆì´ì €',detail:`${mainColor}, ì˜¤ë²„í•`},
        {category:'ìƒì˜',name:'ì…”ì¸ ',detail:`${subColor}, ìŠ¤íŠ¸ë¼ì´í”„`},
        {category:'í•˜ì˜',name:'ì™€ì´ë“œ íŒ¬ì¸ ',detail:'ë² ì´ì§€'},
        {category:'ì‹ ë°œ',name:'ë¡œí¼',detail:'ë¸Œë¼ìš´'},
        {category:'ì†Œí’ˆ',name:'í† íŠ¸ë°±',detail:mainColor}
      ];
    }else{
      fallback=[
        {category:'ì•„ìš°í„°',name:'íŠ¸ë Œì¹˜ì½”íŠ¸',detail:`${mainColor}, í´ë˜ì‹`},
        {category:'ìƒì˜',name:'ì…”ì¸ ',detail:`${subColor}, ë“œë ˆìŠ¤ì…”ì¸ `},
        {category:'í•˜ì˜',name:'ìŠ¬ë™ìŠ¤',detail:'ë„¤ì´ë¹„'},
        {category:'ì‹ ë°œ',name:'ë ˆë”ë¡œí¼',detail:'ë¸Œë¼ìš´'},
        {category:'ì†Œí’ˆ',name:'ë ˆë”ë²¨íŠ¸',detail:'ë¸Œë¼ìš´'}
      ];
    }
  }else{
    // ë”°ëœ»í•œ ë‚ ì”¨
    if(userAge<20){
      fallback=[
        {category:'ìƒì˜',name:'ì˜¤ë²„í• í‹°ì…”ì¸ ',detail:`${mainColor}, í”„ë¦°íŠ¸`},
        {category:'í•˜ì˜',name:'ìˆíŒ¬ì¸ ',detail:`${subColor}`},
        {category:'ì‹ ë°œ',name:'ìŠ¤ë‹ˆì»¤ì¦ˆ',detail:'í™”ì´íŠ¸'},
        {category:'ì†Œí’ˆ',name:'ë³¼ìº¡',detail:'ë¸”ë™'},
        {category:'ê°€ë°©',name:'í¬ë¡œìŠ¤ë°±',detail:'ë¸”ë™'}
      ];
    }else{
      fallback=[
        {category:'ìƒì˜',name:'ë¦°ë„¨ ì…”ì¸ ',detail:`${mainColor}`},
        {category:'í•˜ì˜',name:'ì¹˜ë…¸ íŒ¬ì¸ ',detail:`${subColor}`},
        {category:'ì‹ ë°œ',name:'ë¡œí¼',detail:'ë¸Œë¼ìš´'},
        {category:'ì†Œí’ˆ',name:'ì„ ê¸€ë¼ìŠ¤',detail:'ë¸”ë™'},
        {category:'ê°€ë°©',name:'í† íŠ¸ë°±',detail:mainColor}
      ];
    }
  }
  
  setOutfit(fallback);
  setReason(`${userAge}ì„¸ ${getGender()}ì˜ ${ageStyle.look} ìŠ¤íƒ€ì¼ì— ë§ì¶˜ ${trends.seasonKr} ì½”ë””ì…ë‹ˆë‹¤. ì²´ê°ì˜¨ë„ ${feelsLike}Â°Cì— ì í•©í•©ë‹ˆë‹¤.`);
  setLoading(false);
  genImage(fallback,currentGen);
},[weather,profile,location]);

useEffect(()=>{if(!weatherLoading&&weather)generate()},[weatherLoading,refreshKey]);

return<div className="pb-24">
<WeatherCard weather={weather} location={location} loading={weatherLoading}/>
{loading?<AIThinkingIndicator status={aiStatus}/>:<>
<div className="mb-6 glass-card rounded-2xl overflow-hidden">
{imgLoading?<div className="aspect-[3/4] flex flex-col items-center justify-center bg-white/5"><div className="loading-spinner mb-4"/><p className="text-gray-400 text-sm">AI ì´ë¯¸ì§€ ìƒì„± ì¤‘...</p><p className="text-gray-500 text-xs mt-2">{getUserInfo()}</p></div>
:image?<div className="relative"><img src={image} className="w-full aspect-[3/4] object-cover"/><button onClick={()=>downloadImage(image,`codimate-${Date.now()}.png`)} className="download-btn" title="ì €ì¥"><Icons.Download/></button><div className="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black/80 to-transparent p-4"><p className="text-white text-sm font-medium">AI ì¶”ì²œ ì½”ë””</p><p className="text-gray-300 text-xs">{getUserInfo()}</p></div></div>
:<PlaceholderImage outfit={outfit} userInfo={getUserInfo()}/>}
</div>
<div className="flex justify-between items-center mb-4">
<div><h2 className="text-xl font-bold text-white">ì˜¤ëŠ˜ì˜ ì¶”ì²œ</h2><p className="text-gray-500 text-xs mt-1">{getUserInfo()}</p></div>
<button onClick={generate} disabled={loading||imgLoading} className="flex items-center gap-2 text-orange-400 text-sm disabled:opacity-50"><Icons.Refresh/>ë‹¤ë¥¸ ìŠ¤íƒ€ì¼</button>
</div>
<div className="space-y-3">{outfit?.map((item,i)=><OutfitItem key={i} item={item} i={i}/>)}</div>
{reason&&<div className="glass-card rounded-xl p-4 mt-4 flex gap-3"><span className="text-xl">ğŸ’¡</span><div><p className="text-white text-sm font-medium mb-1">AI ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸</p><p className="text-gray-400 text-sm">{reason}</p></div></div>}
<button className="w-full btn-primary py-4 rounded-2xl font-semibold text-white mt-6 flex items-center justify-center gap-2"><Icons.Cart/>êµ¬ë§¤í•˜ê¸°</button>
</>}
<button onClick={onReset} className="w-full btn-secondary py-3 rounded-xl text-gray-400 mt-3 flex items-center justify-center gap-2 hover:text-white transition-colors"><Icons.Reset/>ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì„¤ì •</button>
</div>}

function ClosetScreen(){return<div className="flex flex-col items-center justify-center py-20 text-center"><div className="text-6xl mb-4">ğŸ‘•</div><h2 className="text-xl font-bold text-white mb-2">ë‚´ ì˜·ì¥</h2><p className="text-gray-400">ê³§ ì—…ë°ì´íŠ¸ ì˜ˆì •!</p></div>}

function TrendScreen(){const trends=generateTrendData();return<div className="pb-24"><div className="flex items-center gap-2 mb-4"><h2 className="text-xl font-bold text-white">ğŸ”¥ {trends.seasonYear} {trends.seasonKr} íŠ¸ë Œë“œ</h2></div><div className="glass-card rounded-xl p-4 mb-4"><h3 className="text-orange-400 font-medium mb-3">í‚¤ì›Œë“œ</h3><div className="flex flex-wrap gap-2">{trends.keywords.map((k,i)=><span key={i} className="px-3 py-1.5 rounded-full bg-orange-500/20 text-orange-400 text-sm">#{k}</span>)}</div></div><div className="glass-card rounded-xl p-4 mb-4"><h3 className="text-purple-400 font-medium mb-3">íŠ¸ë Œë“œ ì»¬ëŸ¬</h3><div className="flex flex-wrap gap-2">{trends.colors.map((c,i)=><span key={i} className="px-3 py-1.5 rounded-full bg-purple-500/20 text-purple-300 text-sm">{c}</span>)}</div></div><div className="glass-card rounded-xl p-4"><h3 className="text-blue-400 font-medium mb-3">ì¸ê¸° ì•„ì´í…œ</h3><div className="flex flex-wrap gap-2">{trends.items.map((item,i)=><span key={i} className="px-3 py-1.5 rounded-full bg-blue-500/20 text-blue-300 text-sm">{item}</span>)}</div></div></div>}

function ProfileScreen({profile,onReset}){const styleMap={};styleCategories.forEach(c=>c.options.forEach(o=>styleMap[o.id]=o.label));const labels=[...profile.styles.map(s=>styleMap[s]||s),...profile.customStyles];const gender=profile.gender==='male'?'ë‚¨ì„±':profile.gender==='female'?'ì—¬ì„±':'ìœ ë‹ˆì„¹ìŠ¤';const age=new Date().getFullYear()-+profile.birthYear;const ageStyle=getAgeStyle(age);return<div className="pb-24"><div className="glass-card rounded-2xl p-6 mb-6 text-center"><div className="w-20 h-20 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-4xl mx-auto mb-4">{profile.gender==='male'?'ğŸ‘¨':profile.gender==='female'?'ğŸ‘©':'ğŸ§‘'}</div><h2 className="text-xl font-bold text-white">{gender} Â· {age}ì„¸</h2><p className="text-gray-400">{ageStyle.desc}</p><p className="text-orange-400 text-sm mt-2">{ageStyle.look} ìŠ¤íƒ€ì¼</p></div><div className="glass-card rounded-xl p-4 mb-4"><p className="text-gray-500 text-sm mb-3">ì„ í˜¸ ìŠ¤íƒ€ì¼</p><div className="flex flex-wrap gap-2">{labels.map((s,i)=><span key={i} className="px-3 py-1.5 rounded-full bg-orange-500/20 text-orange-400 text-sm">{s}</span>)}</div></div><div className="glass-card rounded-xl p-4 mb-4"><p className="text-gray-500 text-sm mb-3">ì—°ë ¹ëŒ€ ì¶”ì²œ ì•„ì´í…œ</p><div className="flex flex-wrap gap-2">{ageStyle.items.map((item,i)=><span key={i} className="px-3 py-1.5 rounded-full bg-blue-500/20 text-blue-300 text-sm">{item}</span>)}</div></div><div className="glass-card rounded-xl overflow-hidden"><button onClick={onReset} className="w-full px-4 py-4 flex justify-between text-white hover:bg-white/5">í”„ë¡œí•„ ë‹¤ì‹œ ì„¤ì •<Icons.Chevron/></button></div><div className="mt-6 text-center"><p className="text-gray-600 text-xs">ì½”ë””ë©”ì´íŠ¸ v10</p></div></div>}

function BottomNav({tab,setTab,onHomeClick}){const tabs=[{id:'home',label:'í™ˆ',Icon:Icons.Home},{id:'closet',label:'ì˜·ì¥',Icon:Icons.Closet},{id:'trend',label:'íŠ¸ë Œë“œ',Icon:Icons.Trend},{id:'profile',label:'í”„ë¡œí•„',Icon:Icons.Profile}];return<nav className="fixed bottom-0 inset-x-0 bg-black/95 backdrop-blur border-t border-white/5 py-2"><div className="flex justify-around max-w-lg mx-auto">{tabs.map(t=><button key={t.id} onClick={()=>{if(t.id==='home'&&tab==='home')onHomeClick();setTab(t.id)}} className={`flex flex-col items-center py-2 px-4 ${tab===t.id?'text-orange-400':'text-gray-500'}`}><t.Icon/><span className="text-xs mt-1">{t.label}</span></button>)}</div></nav>}

function App(){const[ready,setReady]=useState(false);const[profile,setProfile]=useState(null);const[tab,setTab]=useState('home');const[weather,setWeather]=useState(null);const[location,setLocation]=useState('ìœ„ì¹˜ í™•ì¸ ì¤‘...');const[weatherLoading,setWeatherLoading]=useState(true);const[refreshKey,setRefreshKey]=useState(0);const handleReset=()=>{setReady(false);setProfile(null);setTab('home');setRefreshKey(0)};const handleHomeRefresh=()=>{setRefreshKey(prev=>prev+1)};useEffect(()=>{if(ready){setWeatherLoading(true);if('geolocation'in navigator){navigator.geolocation.getCurrentPosition(async(pos)=>{const{latitude,longitude}=pos.coords;const[weatherData,locationName]=await Promise.all([fetchWeather(latitude,longitude),fetchLocationName(latitude,longitude)]);setWeather(weatherData);setLocation(locationName);setWeatherLoading(false)},async()=>{const weatherData=await fetchWeather(37.5665,126.9780);setWeather(weatherData);setLocation('ì„œìš¸ (ê¸°ë³¸)');setWeatherLoading(false)},{enableHighAccuracy:true,timeout:10000})}else{fetchWeather(37.5665,126.9780).then(data=>{setWeather(data);setLocation('ì„œìš¸ (ê¸°ë³¸)');setWeatherLoading(false)})}}},[ready]);if(!ready)return<Onboarding onComplete={p=>{setProfile(p);setReady(true)}}/>;return<div className="min-h-screen max-w-lg mx-auto"><header className="px-6 py-4 flex justify-between items-center"><h1 className="text-xl font-bold text-white" style={{fontFamily:'Outfit'}}>ì½”ë””ë©”ì´íŠ¸</h1><span className="text-xs bg-gradient-to-r from-orange-500 to-pink-500 text-white px-2 py-1 rounded-full">v10</span></header><main className="px-6">{tab==='home'&&<HomeScreen profile={profile} weather={weather} location={location} weatherLoading={weatherLoading} onReset={handleReset} refreshKey={refreshKey}/>}{tab==='closet'&&<ClosetScreen/>}{tab==='trend'&&<TrendScreen/>}{tab==='profile'&&<ProfileScreen profile={profile} onReset={handleReset}/>}</main><BottomNav tab={tab} setTab={setTab} onHomeClick={handleHomeRefresh}/></div>}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
