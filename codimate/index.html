<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ì½”ë””ë©”ì´íŠ¸ - AI íŒ¨ì…˜ ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Noto Sans KR', 'sans-serif'],
            display: ['Outfit', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#fef7ee',
              100: '#fdedd3',
              200: '#fad7a5',
              300: '#f6bc6d',
              400: '#f19a3e',
              500: '#ed7d1a',
              600: '#de6210',
              700: '#b84a10',
              800: '#933b15',
              900: '#773314',
            },
            surface: {
              50: '#fafaf9',
              100: '#f5f5f4',
              200: '#e7e5e4',
              800: '#292524',
              900: '#1c1917',
            }
          }
        }
      }
    }
  </script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(180deg, #1c1917 0%, #292524 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .weather-glow {
      background: radial-gradient(ellipse at center, rgba(241, 154, 62, 0.15) 0%, transparent 70%);
    }
    .outfit-item {
      background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .outfit-item:hover {
      border-color: rgba(241, 154, 62, 0.3);
      transform: translateX(4px);
    }
    .nav-item { transition: all 0.2s ease; }
    .nav-item.active { color: #f19a3e; }
    .btn-primary {
      background: linear-gradient(135deg, #f19a3e 0%, #ed7d1a 100%);
      box-shadow: 0 4px 20px rgba(241, 154, 62, 0.3);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      box-shadow: 0 6px 30px rgba(241, 154, 62, 0.4);
      transform: translateY(-2px);
    }
    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.25);
    }
    .style-chip.selected {
      background: linear-gradient(135deg, #f19a3e 0%, #ed7d1a 100%);
      border-color: transparent;
      color: white;
    }
    .progress-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    .progress-dot.active {
      background: #f19a3e;
      width: 24px;
      border-radius: 4px;
    }
    .progress-dot.completed { background: #f19a3e; }
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: #f19a3e;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 0.4s ease forwards; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // Gemini API ì„¤ì •
    const GEMINI_API_KEY = 'AIzaSyAb8Wq-Eh7rzAk3ZsVpvJiL5ZXq_DTnuiU';
    const GEMINI_TEXT_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
    
    // ì´ë¯¸ì§€ ìƒì„± ëª¨ë¸ë“¤ (ìˆœì„œëŒ€ë¡œ ì‹œë„)
    const IMAGE_MODELS = [
      'gemini-2.0-flash-preview-image-generation',
      'gemini-2.5-flash-image-preview', 
      'gemini-2.5-flash-image',
      'imagen-3.0-generate-002'
    ];

    // ëª©ì—… ë‚ ì”¨ ë°ì´í„°
    const mockWeatherData = {
      location: 'ëŒ€êµ¬',
      temperature: 3,
      tempMax: 12,
      tempMin: -2,
      condition: 'ë§‘ìŒ',
      humidity: 45,
      wind: 3.2,
      icon: 'â˜€ï¸',
      description: 'ì¼êµì°¨ê°€ í° ë§‘ì€ ë‚ ì”¨'
    };

    // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ë“¤
    const HomeIcon = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
    );
    const ClosetIcon = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="12" y1="3" x2="12" y2="21"></line>
      </svg>
    );
    const TrendIcon = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );
    const ProfileIcon = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    );
    const RefreshIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
      </svg>
    );
    const CartIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="9" cy="21" r="1"></circle>
        <circle cx="20" cy="21" r="1"></circle>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
      </svg>
    );
    const ChevronIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    );

    // ì˜¨ë³´ë”© í™”ë©´
    function OnboardingScreen({ onComplete }) {
      const [step, setStep] = useState(0);
      const [profile, setProfile] = useState({ gender: '', ageGroup: '', styles: [] });

      const styleOptions = [
        { id: 'minimal', label: 'ë¯¸ë‹ˆë©€', emoji: 'â—»ï¸' },
        { id: 'casual', label: 'ìºì£¼ì–¼', emoji: 'ğŸ‘•' },
        { id: 'street', label: 'ìŠ¤íŠ¸ë¦¿', emoji: 'ğŸ§¢' },
        { id: 'formal', label: 'í¬ë©€', emoji: 'ğŸ‘”' },
        { id: 'sporty', label: 'ìŠ¤í¬í‹°', emoji: 'ğŸƒ' },
        { id: 'romantic', label: 'ë¡œë§¨í‹±', emoji: 'ğŸŒ¸' },
        { id: 'vintage', label: 'ë¹ˆí‹°ì§€', emoji: 'ğŸ“»' },
        { id: 'modern', label: 'ëª¨ë˜', emoji: 'ğŸ›ï¸' }
      ];

      const handleStyleToggle = (styleId) => {
        setProfile(prev => ({
          ...prev,
          styles: prev.styles.includes(styleId)
            ? prev.styles.filter(s => s !== styleId)
            : [...prev.styles, styleId]
        }));
      };

      const canProceed = () => {
        if (step === 0) return true;
        if (step === 1) return profile.gender !== '';
        if (step === 2) return profile.ageGroup !== '';
        if (step === 3) return profile.styles.length > 0;
        return false;
      };

      const handleNext = () => {
        if (step < 3) setStep(step + 1);
        else onComplete(profile);
      };

      return (
        <div className="min-h-screen flex flex-col px-6 py-8">
          <div className="flex justify-center gap-2 mb-12">
            {[0, 1, 2, 3].map(i => (
              <div key={i} className={`progress-dot ${i === step ? 'active' : i < step ? 'completed' : ''}`} />
            ))}
          </div>

          <div className="flex-1 flex flex-col justify-center">
            {step === 0 && (
              <div className="text-center animate-fade-in">
                <div className="text-6xl mb-6">ğŸ‘”</div>
                <h1 className="font-display text-3xl font-bold text-white mb-4">ì½”ë””ë©”ì´íŠ¸</h1>
                <p className="text-gray-400 text-lg leading-relaxed">
                  ë‚ ì”¨ì™€ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•´<br/>ë‹¹ì‹ ë§Œì˜ ì™„ë²½í•œ ì½”ë””ë¥¼ ì¶”ì²œí•´ë“œë ¤ìš”
                </p>
              </div>
            )}

            {step === 1 && (
              <div className="animate-fade-in">
                <h2 className="text-2xl font-bold text-white mb-2 text-center">ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                <p className="text-gray-400 text-center mb-8">ë§ì¶¤ ìŠ¤íƒ€ì¼ ì¶”ì²œì„ ìœ„í•´ í•„ìš”í•´ìš”</p>
                <div className="flex gap-4 justify-center">
                  {[{ id: 'male', label: 'ë‚¨ì„±', emoji: 'ğŸ‘¨' }, { id: 'female', label: 'ì—¬ì„±', emoji: 'ğŸ‘©' }].map(option => (
                    <button
                      key={option.id}
                      onClick={() => setProfile(prev => ({ ...prev, gender: option.id }))}
                      className={`flex-1 max-w-[140px] py-6 rounded-2xl border-2 transition-all ${
                        profile.gender === option.id
                          ? 'border-primary-500 bg-primary-500/10'
                          : 'border-white/10 bg-white/5 hover:border-white/20'
                      }`}
                    >
                      <div className="text-4xl mb-2">{option.emoji}</div>
                      <div className="text-white font-medium">{option.label}</div>
                    </button>
                  ))}
                </div>
              </div>
            )}

            {step === 2 && (
              <div className="animate-fade-in">
                <h2 className="text-2xl font-bold text-white mb-2 text-center">ë‚˜ì´ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                <p className="text-gray-400 text-center mb-8">ì—°ë ¹ì— ë§ëŠ” ìŠ¤íƒ€ì¼ì„ ì¶”ì²œí•´ë“œë ¤ìš”</p>
                <div className="grid grid-cols-2 gap-3 max-w-sm mx-auto">
                  {['10ëŒ€', '20ëŒ€', '30ëŒ€', '40ëŒ€', '50ëŒ€ ì´ìƒ'].map(age => (
                    <button
                      key={age}
                      onClick={() => setProfile(prev => ({ ...prev, ageGroup: age }))}
                      className={`py-4 rounded-xl border-2 transition-all ${
                        profile.ageGroup === age
                          ? 'border-primary-500 bg-primary-500/10 text-white'
                          : 'border-white/10 bg-white/5 text-gray-300 hover:border-white/20'
                      }`}
                    >
                      {age}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {step === 3 && (
              <div className="animate-fade-in">
                <h2 className="text-2xl font-bold text-white mb-2 text-center">ì„ í˜¸í•˜ëŠ” ìŠ¤íƒ€ì¼ì€?</h2>
                <p className="text-gray-400 text-center mb-8">ì—¬ëŸ¬ ê°œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”</p>
                <div className="flex flex-wrap gap-3 justify-center max-w-sm mx-auto">
                  {styleOptions.map(style => (
                    <button
                      key={style.id}
                      onClick={() => handleStyleToggle(style.id)}
                      className={`style-chip px-4 py-3 rounded-full border-2 flex items-center gap-2 transition-all ${
                        profile.styles.includes(style.id)
                          ? 'selected'
                          : 'border-white/10 bg-white/5 text-gray-300 hover:border-white/20'
                      }`}
                    >
                      <span>{style.emoji}</span>
                      <span>{style.label}</span>
                    </button>
                  ))}
                </div>
              </div>
            )}
          </div>

          <div className="mt-8">
            <button
              onClick={handleNext}
              disabled={!canProceed()}
              className={`w-full py-4 rounded-2xl font-semibold text-white transition-all ${
                canProceed() ? 'btn-primary' : 'bg-gray-700 opacity-50 cursor-not-allowed'
              }`}
            >
              {step === 3 ? 'ì‹œì‘í•˜ê¸°' : 'ë‹¤ìŒ'}
            </button>
          </div>
        </div>
      );
    }

    // ë‚ ì”¨ ì¹´ë“œ
    function WeatherCard({ weather }) {
      return (
        <div className="glass-card rounded-2xl p-5 mb-6 relative overflow-hidden">
          <div className="weather-glow absolute inset-0 pointer-events-none" />
          <div className="relative z-10">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <span className="text-primary-400">ğŸ“</span>
                <span className="text-white font-medium">{weather.location}</span>
              </div>
              <span className="text-gray-400 text-sm">ì˜¤ëŠ˜</span>
            </div>
            <div className="flex items-center justify-between">
              <div>
                <div className="flex items-baseline gap-1">
                  <span className="text-5xl font-display font-bold text-white">{weather.temperature}</span>
                  <span className="text-2xl text-gray-400">Â°C</span>
                </div>
                <div className="text-gray-400 text-sm mt-1">
                  {weather.tempMin}Â° / {weather.tempMax}Â° ì¼êµì°¨ {weather.tempMax - weather.tempMin}Â°
                </div>
              </div>
              <div className="text-right">
                <div className="text-5xl mb-1">{weather.icon}</div>
                <div className="text-gray-300 text-sm">{weather.condition}</div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ì½”ë”” ì•„ì´í…œ
    function OutfitItem({ item, index }) {
      const categoryEmoji = {
        'ìƒì˜': 'ğŸ‘•', 'í•˜ì˜': 'ğŸ‘–', 'ì•„ìš°í„°': 'ğŸ§¥',
        'ì–‘ë§': 'ğŸ§¦', 'ì‹ ë°œ': 'ğŸ‘Ÿ', 'ì†Œí’ˆ': 'ğŸ‘œ'
      };
      return (
        <div className="outfit-item rounded-xl p-4 animate-fade-in" style={{ animationDelay: `${index * 0.1}s` }}>
          <div className="flex items-center gap-4">
            <div className="w-12 h-12 rounded-lg bg-white/5 flex items-center justify-center text-2xl">
              {categoryEmoji[item.category] || 'ğŸ‘”'}
            </div>
            <div className="flex-1 min-w-0">
              <div className="text-xs text-primary-400 font-medium mb-1">{item.category}</div>
              <div className="text-white font-medium truncate">{item.name}</div>
              {item.detail && <div className="text-gray-500 text-sm truncate">{item.detail}</div>}
            </div>
            <div className="text-gray-500"><ChevronIcon /></div>
          </div>
        </div>
      );
    }

    // ë¡œë”©
    function LoadingScreen({ message }) {
      return (
        <div className="flex flex-col items-center justify-center py-20">
          <div className="loading-spinner mb-4"></div>
          <p className="text-gray-400">{message || 'AIê°€ ì½”ë””ë¥¼ ë¶„ì„ ì¤‘...'}</p>
        </div>
      );
    }

    // ë©”ì¸ í™ˆ í™”ë©´
    function HomeScreen({ profile, weather }) {
      const [outfit, setOutfit] = useState(null);
      const [loading, setLoading] = useState(true);
      const [imageLoading, setImageLoading] = useState(false);
      const [aiReason, setAiReason] = useState('');
      const [outfitImage, setOutfitImage] = useState(null);
      const [imageError, setImageError] = useState(null);
      const [imageStatus, setImageStatus] = useState('');

      // ì´ë¯¸ì§€ ìƒì„± í•¨ìˆ˜ - ì—¬ëŸ¬ ëª¨ë¸ ì‹œë„
      const generateOutfitImage = async (outfitItems, genderLabel, ageGroup, userStyles) => {
        setImageLoading(true);
        setOutfitImage(null);
        setImageError(null);

        const outfitDescription = outfitItems.map(item => 
          `${item.category}: ${item.name} (${item.detail})`
        ).join(', ');

        const imagePrompt = `Create a high-quality fashion photography of a stylish ${genderLabel === 'ë‚¨ì„±' ? 'Korean man' : 'Korean woman'} in their ${ageGroup}. 
Full body shot, standing pose, modern urban background.
The outfit consists of: ${outfitDescription}
Style: ${userStyles} fashion, trendy 2025 Korean street style.
Lighting: Natural daylight, soft shadows.
Quality: Professional fashion magazine quality.
Do NOT include any text or watermarks.`;

        // ì—¬ëŸ¬ ëª¨ë¸ì„ ìˆœì„œëŒ€ë¡œ ì‹œë„
        for (const modelName of IMAGE_MODELS) {
          setImageStatus(`${modelName} ì‹œë„ ì¤‘...`);
          console.log(`Trying model: ${modelName}`);

          try {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${GEMINI_API_KEY}`;
            
            const response = await fetch(apiUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                contents: [{ parts: [{ text: imagePrompt }] }],
                generationConfig: {
                  responseModalities: ["TEXT", "IMAGE"]
                }
              })
            });

            const data = await response.json();
            console.log(`Response from ${modelName}:`, data);

            if (!response.ok) {
              console.log(`Model ${modelName} failed:`, data.error?.message || 'Unknown error');
              continue; // ë‹¤ìŒ ëª¨ë¸ ì‹œë„
            }

            // ì‘ë‹µì—ì„œ ì´ë¯¸ì§€ ë°ì´í„° ì¶”ì¶œ
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
              const parts = data.candidates[0].content.parts;
              for (const part of parts) {
                if (part.inlineData) {
                  const base64Image = part.inlineData.data;
                  const mimeType = part.inlineData.mimeType || 'image/png';
                  setOutfitImage(`data:${mimeType};base64,${base64Image}`);
                  setImageStatus(`${modelName}ë¡œ ìƒì„± ì™„ë£Œ!`);
                  setImageLoading(false);
                  return; // ì„±ê³µ!
                }
              }
            }
          } catch (err) {
            console.error(`Error with ${modelName}:`, err);
            continue; // ë‹¤ìŒ ëª¨ë¸ ì‹œë„
          }
        }

        // ëª¨ë“  ëª¨ë¸ ì‹¤íŒ¨
        setImageError('ì´ë¯¸ì§€ ìƒì„± APIì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. API í‚¤ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        setImageStatus('');
        setImageLoading(false);
      };

      const generateOutfit = async () => {
        setLoading(true);
        setOutfit(null);
        setOutfitImage(null);
        setImageError(null);

        const styleLabels = {
          minimal: 'ë¯¸ë‹ˆë©€', casual: 'ìºì£¼ì–¼', street: 'ìŠ¤íŠ¸ë¦¿',
          formal: 'í¬ë©€', sporty: 'ìŠ¤í¬í‹°', romantic: 'ë¡œë§¨í‹±',
          vintage: 'ë¹ˆí‹°ì§€', modern: 'ëª¨ë˜'
        };
        const userStyles = profile.styles.map(s => styleLabels[s]).join(', ');
        const genderLabel = profile.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';

        const prompt = `ë‹¹ì‹ ì€ ì „ë¬¸ íŒ¨ì…˜ ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ì¡°ê±´ì— ë§ëŠ” ì˜¤ëŠ˜ì˜ ì½”ë””ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.

ì¡°ê±´:
- ë‚ ì”¨: ${weather.condition}, í˜„ì¬ê¸°ì˜¨ ${weather.temperature}Â°C, ìµœì € ${weather.tempMin}Â°C, ìµœê³  ${weather.tempMax}Â°C
- ì‚¬ìš©ì: ${genderLabel}, ${profile.ageGroup}
- ì„ í˜¸ ìŠ¤íƒ€ì¼: ${userStyles}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ë‹µë³€í•´ì£¼ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”:
{
  "items": [
    {"category": "ìƒì˜", "name": "ì•„ì´í…œëª…", "detail": "ìƒ‰ìƒì´ë‚˜ ì†Œì¬ ì„¤ëª…"},
    {"category": "í•˜ì˜", "name": "ì•„ì´í…œëª…", "detail": "ìƒ‰ìƒì´ë‚˜ ì†Œì¬ ì„¤ëª…"},
    {"category": "ì•„ìš°í„°", "name": "ì•„ì´í…œëª…", "detail": "ìƒ‰ìƒì´ë‚˜ ì†Œì¬ ì„¤ëª…"},
    {"category": "ì–‘ë§", "name": "ì•„ì´í…œëª…", "detail": "ìƒ‰ìƒì´ë‚˜ ì†Œì¬ ì„¤ëª…"},
    {"category": "ì‹ ë°œ", "name": "ì•„ì´í…œëª…", "detail": "ìƒ‰ìƒì´ë‚˜ ì†Œì¬ ì„¤ëª…"},
    {"category": "ì†Œí’ˆ", "name": "ì•„ì´í…œëª…", "detail": "ìƒ‰ìƒì´ë‚˜ ì†Œì¬ ì„¤ëª…"}
  ],
  "reason": "ì´ ì½”ë””ë¥¼ ì¶”ì²œí•˜ëŠ” ì´ìœ  (2-3ë¬¸ì¥)"
}`;

        try {
          const response = await fetch(`${GEMINI_TEXT_URL}?key=${GEMINI_API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }],
              generationConfig: { temperature: 0.9, maxOutputTokens: 1024 }
            })
          });

          if (!response.ok) throw new Error('API ìš”ì²­ ì‹¤íŒ¨');

          const data = await response.json();
          const text = data.candidates[0].content.parts[0].text;
          
          const jsonMatch = text.match(/\{[\s\S]*\}/);
          if (jsonMatch) {
            const result = JSON.parse(jsonMatch[0]);
            setOutfit(result.items);
            setAiReason(result.reason);
            setLoading(false);
            
            // ì½”ë”” ì¶”ì²œ ì™„ë£Œ í›„ ì´ë¯¸ì§€ ìƒì„± ì‹œì‘
            generateOutfitImage(result.items, genderLabel, profile.ageGroup, userStyles);
          } else {
            throw new Error('ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨');
          }
        } catch (err) {
          console.error('Error:', err);
          const fallbackItems = [
            { category: 'ìƒì˜', name: 'í™”ì´íŠ¸ ì˜¥ìŠ¤í¬ë“œ ì…”ì¸ ', detail: 'ë©´ 100%' },
            { category: 'í•˜ì˜', name: 'ë„¤ì´ë¹„ ì¹˜ë…¸ íŒ¬ì¸ ', detail: 'ìŠ¬ë¦¼í•' },
            { category: 'ì•„ìš°í„°', name: 'ë² ì´ì§€ íŠ¸ë Œì¹˜ì½”íŠ¸', detail: 'ë¯¸ë””ì—„ ê¸°ì¥' },
            { category: 'ì–‘ë§', name: 'ì°¨ì½œ ë¬´ì§€ ì–‘ë§', detail: 'ì¤‘ëª©' },
            { category: 'ì‹ ë°œ', name: 'ë¸Œë¼ìš´ ë ˆë” ë¡œí¼', detail: 'í´ë˜ì‹' },
            { category: 'ì†Œí’ˆ', name: 'ì‹¤ë²„ ë¯¸ë‹ˆë©€ ì‹œê³„', detail: 'ë©”ì‰¬ ë°´ë“œ' }
          ];
          setOutfit(fallbackItems);
          setAiReason('ì¼êµì°¨ê°€ í° ë‚ ì”¨ì— ë ˆì´ì–´ë“œ ìŠ¤íƒ€ì¼ë¡œ ì²´ì˜¨ ì¡°ì ˆì´ ìš©ì´í•©ë‹ˆë‹¤.');
          setLoading(false);
          generateOutfitImage(fallbackItems, genderLabel, profile.ageGroup, userStyles);
        }
      };

      useEffect(() => { generateOutfit(); }, []);

      return (
        <div className="pb-24">
          <WeatherCard weather={weather} />
          
          {/* AI ìƒì„± ì½”ë”” ì´ë¯¸ì§€ */}
          <div className="mb-6">
            <div className="glass-card rounded-2xl overflow-hidden">
              {imageLoading ? (
                <div className="aspect-[3/4] flex flex-col items-center justify-center bg-white/5">
                  <div className="loading-spinner mb-4"></div>
                  <p className="text-gray-400 text-sm">AIê°€ ì½”ë”” ì´ë¯¸ì§€ë¥¼ ìƒì„± ì¤‘...</p>
                  {imageStatus && <p className="text-primary-400 text-xs mt-2">{imageStatus}</p>}
                </div>
              ) : outfitImage ? (
                <div className="relative">
                  <img src={outfitImage} alt="AI ì¶”ì²œ ì½”ë””" className="w-full aspect-[3/4] object-cover" />
                  <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                    <p className="text-white text-sm font-medium">AIê°€ ì¶”ì²œí•˜ëŠ” ì˜¤ëŠ˜ì˜ ì½”ë””</p>
                    <p className="text-gray-300 text-xs mt-1">Gemini AIë¡œ ìƒì„±ëœ ì´ë¯¸ì§€</p>
                  </div>
                </div>
              ) : imageError ? (
                <div className="aspect-[3/4] flex flex-col items-center justify-center bg-white/5 p-6">
                  <span className="text-5xl mb-4">âš ï¸</span>
                  <p className="text-gray-400 text-sm text-center mb-2">ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨</p>
                  <p className="text-gray-500 text-xs text-center mb-4">{imageError}</p>
                  <button 
                    onClick={() => {
                      const styleLabels = { minimal: 'ë¯¸ë‹ˆë©€', casual: 'ìºì£¼ì–¼', street: 'ìŠ¤íŠ¸ë¦¿', formal: 'í¬ë©€', sporty: 'ìŠ¤í¬í‹°', romantic: 'ë¡œë§¨í‹±', vintage: 'ë¹ˆí‹°ì§€', modern: 'ëª¨ë˜' };
                      const userStyles = profile.styles.map(s => styleLabels[s]).join(', ');
                      const genderLabel = profile.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±';
                      generateOutfitImage(outfit, genderLabel, profile.ageGroup, userStyles);
                    }}
                    className="px-4 py-2 text-sm text-primary-400 border border-primary-400/30 rounded-lg hover:bg-primary-400/10 transition-colors"
                  >
                    ë‹¤ì‹œ ì‹œë„
                  </button>
                </div>
              ) : loading ? (
                <div className="aspect-[3/4] flex flex-col items-center justify-center bg-white/5">
                  <div className="loading-spinner mb-4"></div>
                  <p className="text-gray-400 text-sm">AIê°€ ì½”ë””ë¥¼ ë¶„ì„ ì¤‘...</p>
                </div>
              ) : (
                <div className="aspect-[3/4] flex flex-col items-center justify-center bg-white/5">
                  <span className="text-6xl mb-4">ğŸ‘”</span>
                  <p className="text-gray-400 text-sm">ì´ë¯¸ì§€ ìƒì„± ëŒ€ê¸° ì¤‘</p>
                </div>
              )}
            </div>
          </div>
          
          {/* ì½”ë”” ì¶”ì²œ ì„¹ì…˜ */}
          <div className="mb-4">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-white">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì½”ë””</h2>
              <button
                onClick={generateOutfit}
                disabled={loading || imageLoading}
                className="flex items-center gap-2 text-primary-400 text-sm font-medium hover:text-primary-300 transition-colors disabled:opacity-50"
              >
                <RefreshIcon />
                ë‹¤ë¥¸ ìŠ¤íƒ€ì¼
              </button>
            </div>
            
            {loading ? (
              <LoadingScreen />
            ) : (
              <div className="space-y-3">
                {outfit && outfit.map((item, index) => (
                  <OutfitItem key={index} item={item} index={index} />
                ))}
              </div>
            )}
          </div>

          {/* AI ì¶”ì²œ ì´ìœ  */}
          {aiReason && !loading && (
            <div className="glass-card rounded-xl p-4 mt-4 animate-fade-in">
              <div className="flex gap-3">
                <span className="text-xl">ğŸ’¡</span>
                <p className="text-gray-300 text-sm leading-relaxed">{aiReason}</p>
              </div>
            </div>
          )}

          {/* êµ¬ë§¤ ë²„íŠ¼ */}
          {!loading && (
            <div className="mt-6">
              <button className="w-full btn-primary py-4 rounded-2xl font-semibold text-white flex items-center justify-center gap-2">
                <CartIcon />
                ì´ ìŠ¤íƒ€ì¼ êµ¬ë§¤í•˜ê¸°
              </button>
            </div>
          )}
        </div>
      );
    }

    // ë‚´ ì˜·ì¥ í™”ë©´
    function ClosetScreen() {
      return (
        <div className="flex flex-col items-center justify-center py-20 text-center">
          <div className="text-6xl mb-4">ğŸ‘•</div>
          <h2 className="text-xl font-bold text-white mb-2">ë‚´ ì˜·ì¥</h2>
          <p className="text-gray-400 mb-6">ê³§ ì—…ë°ì´íŠ¸ ì˜ˆì •ì´ì—ìš”!<br/>ì˜·ì„ ë“±ë¡í•˜ê³  AI ë§ì¶¤ ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”.</p>
          <button className="btn-secondary px-6 py-3 rounded-xl text-white font-medium">ì•Œë¦¼ ë°›ê¸°</button>
        </div>
      );
    }

    // íŠ¸ë Œë“œ í™”ë©´
    function TrendScreen() {
      const trends = [
        { tag: '#ë¯¸ë‹ˆë©€ë£©', desc: 'ê¹”ë”í•œ ë¼ì¸ì˜ ë² ì´ì§ ì•„ì´í…œ', hot: true },
        { tag: '#ë ˆì´ì–´ë“œ', desc: 'ê²¹ì³ì…ê¸°ë¡œ ìŠ¤íƒ€ì¼ ì™„ì„±', hot: true },
        { tag: '#ì–´ìŠ¤í†¤', desc: 'ìì—°ì—ì„œ ì˜ê°ë°›ì€ ì»¬ëŸ¬', hot: false },
        { tag: '#ì˜¤ë²„í•', desc: 'ì—¬ìœ ë¡œìš´ ì‹¤ë£¨ì—£', hot: false }
      ];

      return (
        <div className="pb-24">
          <h2 className="text-xl font-bold text-white mb-4">ğŸ”¥ ì´ë²ˆ ì£¼ íŠ¸ë Œë“œ</h2>
          <div className="space-y-3">
            {trends.map((trend, index) => (
              <div key={index} className="glass-card rounded-xl p-4 flex items-center justify-between">
                <div>
                  <div className="flex items-center gap-2 mb-1">
                    <span className="text-primary-400 font-semibold">{trend.tag}</span>
                    {trend.hot && <span className="text-xs bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full">HOT</span>}
                  </div>
                  <p className="text-gray-400 text-sm">{trend.desc}</p>
                </div>
                <div className="text-gray-500"><ChevronIcon /></div>
              </div>
            ))}
          </div>
          <div className="glass-card rounded-xl p-6 mt-6 text-center">
            <p className="text-gray-400">ì‹¤ì‹œê°„ íŠ¸ë Œë“œ ë¶„ì„ ê¸°ëŠ¥ì´<br/>ê³§ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤!</p>
          </div>
        </div>
      );
    }

    // í”„ë¡œí•„ í™”ë©´
    function ProfileScreen({ profile }) {
      const styleLabels = {
        minimal: 'ë¯¸ë‹ˆë©€', casual: 'ìºì£¼ì–¼', street: 'ìŠ¤íŠ¸ë¦¿',
        formal: 'í¬ë©€', sporty: 'ìŠ¤í¬í‹°', romantic: 'ë¡œë§¨í‹±',
        vintage: 'ë¹ˆí‹°ì§€', modern: 'ëª¨ë˜'
      };

      return (
        <div className="pb-24">
          <div className="glass-card rounded-2xl p-6 mb-6 text-center">
            <div className="w-20 h-20 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-4xl mx-auto mb-4">
              {profile.gender === 'male' ? 'ğŸ‘¨' : 'ğŸ‘©'}
            </div>
            <h2 className="text-xl font-bold text-white mb-1">ì‚¬ìš©ìë‹˜</h2>
            <p className="text-gray-400">{profile.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'} Â· {profile.ageGroup}</p>
          </div>

          <div className="glass-card rounded-xl p-4 mb-4">
            <div className="text-gray-400 text-sm mb-3">ì„ í˜¸ ìŠ¤íƒ€ì¼</div>
            <div className="flex flex-wrap gap-2">
              {profile.styles.map(style => (
                <span key={style} className="px-3 py-1.5 rounded-full bg-primary-500/20 text-primary-400 text-sm">
                  {styleLabels[style]}
                </span>
              ))}
            </div>
          </div>

          <div className="glass-card rounded-xl overflow-hidden">
            {['í”„ë¡œí•„ ìˆ˜ì •', 'ì•Œë¦¼ ì„¤ì •', 'ì•± ì •ë³´', 'í”¼ë“œë°± ë³´ë‚´ê¸°'].map((item, index) => (
              <button
                key={item}
                className={`w-full px-4 py-4 flex items-center justify-between text-white hover:bg-white/5 transition-colors ${index !== 0 ? 'border-t border-white/5' : ''}`}
              >
                <span>{item}</span>
                <ChevronIcon />
              </button>
            ))}
          </div>
        </div>
      );
    }

    // í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜
    function BottomNav({ activeTab, onTabChange }) {
      const tabs = [
        { id: 'home', label: 'í™ˆ', Icon: HomeIcon },
        { id: 'closet', label: 'ì˜·ì¥', Icon: ClosetIcon },
        { id: 'trend', label: 'íŠ¸ë Œë“œ', Icon: TrendIcon },
        { id: 'profile', label: 'í”„ë¡œí•„', Icon: ProfileIcon }
      ];

      return (
        <nav className="fixed bottom-0 left-0 right-0 bg-surface-900/95 backdrop-blur-lg border-t border-white/5 px-2 py-2 z-50">
          <div className="flex justify-around items-center max-w-lg mx-auto">
            {tabs.map(tab => (
              <button
                key={tab.id}
                onClick={() => onTabChange(tab.id)}
                className={`nav-item relative flex flex-col items-center py-2 px-4 ${activeTab === tab.id ? 'active text-primary-400' : 'text-gray-500'}`}
              >
                <tab.Icon />
                <span className="text-xs mt-1 font-medium">{tab.label}</span>
              </button>
            ))}
          </div>
        </nav>
      );
    }

    // ë©”ì¸ ì•±
    function App() {
      const [isOnboarded, setIsOnboarded] = useState(false);
      const [profile, setProfile] = useState(null);
      const [activeTab, setActiveTab] = useState('home');

      const handleOnboardingComplete = (userProfile) => {
        setProfile(userProfile);
        setIsOnboarded(true);
      };

      if (!isOnboarded) {
        return <OnboardingScreen onComplete={handleOnboardingComplete} />;
      }

      return (
        <div className="min-h-screen max-w-lg mx-auto">
          <header className="px-6 py-4 flex items-center justify-between">
            <h1 className="font-display text-xl font-bold text-white">ì½”ë””ë©”ì´íŠ¸</h1>
            <div className="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center">
              <span className="text-sm">ğŸ””</span>
            </div>
          </header>

          <main className="px-6">
            {activeTab === 'home' && <HomeScreen profile={profile} weather={mockWeatherData} />}
            {activeTab === 'closet' && <ClosetScreen />}
            {activeTab === 'trend' && <TrendScreen />}
            {activeTab === 'profile' && <ProfileScreen profile={profile} />}
          </main>

          <BottomNav activeTab={activeTab} onTabChange={setActiveTab} />
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
